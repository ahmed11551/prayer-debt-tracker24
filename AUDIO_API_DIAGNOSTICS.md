# Диагностика проблемы с аудио из API

## Текущая ситуация

Вы видите сообщение: **"Аудио из API недоступно. Используется синтез речи браузера"**

Это означает, что:
- ✅ Приложение пыталось загрузить аудио из e-Replika API
- ❌ API не вернул аудио для данного дуа
- ✅ TTS (синтез речи) работает как fallback

## Возможные причины

### 1. ID дуа не совпадают с API

**Проблема**: Локальные ID в приложении (например, `"sleep-1"`, `"kalima-1"`) могут не совпадать с ID в базе данных e-Replika API.

**Решение**: Приложение теперь пробует несколько вариантов ID:
- Оригинальный ID (`"sleep-1"`)
- ID без префикса (`"1"`)
- Последняя часть после дефиса

### 2. API не содержит все дуа

**Проблема**: Не все дуа из приложения могут быть в базе данных e-Replika API.

**Решение**: Это нормально. TTS используется как надежный fallback.

### 3. Проблемы с авторизацией

**Проверьте**:
- Правильно ли настроен `VITE_API_TOKEN` в `.env`
- Используется ли `test_token_123` по умолчанию
- Доступен ли API по адресу `https://bot.e-replika.ru/api`

### 4. API недоступен или изменился

**Проверьте**:
- Доступен ли API (`https://bot.e-replika.ru/api`)
- Не изменились ли эндпоинты в документации
- Нет ли проблем с CORS

## Как диагностировать проблему

### Способ 1: Использовать утилиты тестирования (в консоли браузера)

1. Откройте консоль браузера (F12)
2. Перейдите в раздел "Зикры" → "Дуа"
3. В консоли выполните:

```javascript
// Тест загрузки аудио для конкретного дуа
await testEReplikaAudioAPI("sleep-1")

// Получить список всех дуа из API
await testEReplikaDuasList()
```

Это покажет:
- Какие эндпоинты пробуются
- Какие ответы возвращает API
- Есть ли проблемы с авторизацией

### Способ 2: Проверить логи в консоли

При загрузке дуа в консоли должны появиться логи:
- `Audio loaded successfully for dua {id}` - аудио найдено
- `Audio not found in API for dua {id}, TTS will be used` - используется TTS
- `Error loading audio from API` - ошибка загрузки

### Способ 3: Проверить сетевые запросы

1. Откройте DevTools (F12)
2. Перейдите на вкладку "Network"
3. Отфильтруйте по "audio" или "dua"
4. Посмотрите запросы к API:
   - Статус ответа (200, 404, 401, etc.)
   - Тело ответа
   - Headers

## Что делать дальше

### Если API работает, но не возвращает аудио:

1. **Проверьте документацию e-Replika API**
   - Убедитесь, что используете правильные эндпоинты
   - Проверьте формат ID дуа в API

2. **Свяжитесь с разработчиками API**
   - Уточните, какие ID используются для дуа
   - Проверьте, есть ли аудио для конкретных дуа

3. **Используйте TTS как основной способ**
   - TTS работает надежно
   - Не требует подключения к API
   - Работает офлайн

### Если API не работает:

1. **Проверьте настройки окружения**
   ```env
   VITE_API_BASE_URL=https://bot.e-replika.ru/api
   VITE_API_TOKEN=test_token_123
   ```

2. **Проверьте доступность API**
   - Откройте `https://bot.e-replika.ru/api` в браузере
   - Проверьте документацию: `https://bot.e-replika.ru/docs#/`

3. **Используйте TTS**
   - TTS работает как надежный fallback
   - Не требует API

## Текущее поведение (правильное)

✅ Приложение пытается загрузить аудио из API  
✅ Если не найдено - используется TTS  
✅ Пользователь видит информативное сообщение  
✅ Все ошибки логируются в консоль  

## Рекомендации

1. **Для разработки**: Используйте утилиты тестирования в консоли
2. **Для продакшена**: TTS работает надежно, даже если API недоступен
3. **Для пользователей**: Сообщение "Используется синтез речи" означает, что все работает корректно

## Вывод

Сообщение **"Аудио из API недоступно. Используется синтез речи браузера"** - это **нормальное поведение**, не ошибка. Приложение работает корректно, используя TTS как fallback, когда API не возвращает аудио.

