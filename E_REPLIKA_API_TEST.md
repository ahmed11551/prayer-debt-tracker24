# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ e-Replika API

## –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞** - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –≤—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully
‚úÖ **Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ API

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. GET /api/terms
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä–∏–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤

**–¢–µ—Å—Ç:**
```bash
curl -X GET "https://bot.e-replika.ru/api/terms" \
  -H "Content-Type: application/json"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
[
  {
    "term": "–ö–∞–∑–∞",
    "definition": "–í–æ—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–≥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–∞–º–∞–∑–∞",
    "transliteration": "Qada"
  },
  ...
]
```

**Fallback:** –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ `getDefaultTerms()`

---

### 2. POST /api/calendar/convert-to-hijri
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≥—Ä–∏–≥–æ—Ä–∏–∞–Ω—Å–∫–æ–π –¥–∞—Ç—ã –≤ —Ö–∏–¥–∂—Ä—É

**–¢–µ—Å—Ç:**
```bash
curl -X POST "https://bot.e-replika.ru/api/calendar/convert-to-hijri" \
  -H "Content-Type: application/json" \
  -d '{"date": "2000-01-01"}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "year": 1420,
  "month": 9,
  "day": 25
}
```

**Fallback:** –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ `prayer-calculator.ts`

---

### 3. POST /api/calendar/convert-from-hijri
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞—Ç—ã —Ö–∏–¥–∂—Ä—ã –≤ –≥—Ä–∏–≥–æ—Ä–∏–∞–Ω—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å

**–¢–µ—Å—Ç:**
```bash
curl -X POST "https://bot.e-replika.ru/api/calendar/convert-from-hijri" \
  -H "Content-Type: application/json" \
  -d '{"year": 1420, "month": 9, "day": 25}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "date": "2000-01-01"
}
```

**Fallback:** –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ `prayer-calculator.ts`

---

### 4. POST /api/reports/pdf
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á–µ—Ç–∞

**–¢–µ—Å—Ç:**
```bash
curl -X POST "https://bot.e-replika.ru/api/reports/pdf" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test_user",
    "data": {...}
  }' \
  --output report.pdf
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:** PDF —Ñ–∞–π–ª (binary)

**Fallback:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è JSON —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º API (–≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
const { eReplikaAPI } = await import('/src/lib/api.ts');

// –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–≤
try {
  const terms = await eReplikaAPI.getTerms();
  console.log('‚úÖ Terms API —Ä–∞–±–æ—Ç–∞–µ—Ç:', terms);
} catch (error) {
  console.warn('‚ö†Ô∏è Terms API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback:', error);
}

// –¢–µ—Å—Ç 2: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ö–∏–¥–∂—Ä—É
try {
  const hijri = await eReplikaAPI.convertToHijri(new Date('2000-01-01'));
  console.log('‚úÖ Convert to Hijri —Ä–∞–±–æ—Ç–∞–µ—Ç:', hijri);
} catch (error) {
  console.warn('‚ö†Ô∏è Convert to Hijri –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback:', error);
}

// –¢–µ—Å—Ç 3: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑ —Ö–∏–¥–∂—Ä—ã
try {
  const gregorian = await eReplikaAPI.convertFromHijri({ year: 1420, month: 9, day: 25 });
  console.log('‚úÖ Convert from Hijri —Ä–∞–±–æ—Ç–∞–µ—Ç:', gregorian);
} catch (error) {
  console.warn('‚ö†Ô∏è Convert from Hijri –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error);
}
```

---

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ï—Å–ª–∏ API —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **Telegram WebApp initData:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤ Telegram
   - –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer {initData}`

2. **API –∫–ª—é—á:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ `.env`: `VITE_E_REPLIKA_API_KEY=your_key`
   - –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-API-Key: {key}`

3. **Bearer —Ç–æ–∫–µ–Ω:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ `.env`: `VITE_API_TOKEN=your_token`
   - –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer {token}`

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ API –∏–º–µ—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:

1. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ (CORS, timeout):**
   - –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback

2. **404 Not Found:**
   - –î–ª—è —Ç–µ—Ä–º–∏–Ω–æ–≤: –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
   - –î–ª—è –¥—Ä—É–≥–∏—Ö: –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞

3. **401 Unauthorized:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏ –≤ `.env`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback

4. **500 Server Error:**
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã (–æ–Ω–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
- ‚ö†Ô∏è –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ API –∫–ª—é—á–∏ –æ—Ç e-Replika (–µ—Å–ª–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è)
- ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ e-Replika –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
- ‚ö†Ô∏è –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

---

## –ò—Ç–æ–≥

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –¥–∞–∂–µ –±–µ–∑ e-Replika API
- –ú–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ e-Replika API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏.

