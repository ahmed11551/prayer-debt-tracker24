# Сравнение требований заказчика с реализацией

## Требования заказчика

### 1. Восполнение намазов
- **Требование**: Отдельный модуль для масштабирования
- **Статус**: ✅ **РЕАЛИЗОВАНО**

**Реализованные компоненты:**
- `src/components/qaza/RepaymentPlanSection.tsx` - План восполнения
- `src/components/qaza/ProgressSection.tsx` - Прогресс восполнения
- `src/components/qaza/CalculatorSection.tsx` - Калькулятор долга
- `src/components/qaza/TravelPrayersSection.tsx` - Периоды сафара
- `src/components/qaza/ReportsSection.tsx` - Отчёты
- `src/components/qaza/PrayerCalendar.tsx` - Календарь намазов
- `src/components/qaza/AddPrayerDialog.tsx` - Добавление намазов

**Модульность**: ✅ Все компоненты в отдельной папке `qaza/`, легко масштабируются

---

### 2. Цели и привычки
- **Требование**: Отдельный модуль для масштабирования
- **Статус**: ✅ **РЕАЛИЗОВАНО**

**Реализованные компоненты:**
- `src/components/qaza/SmartGoalsSection.tsx` - Основной раздел целей
- `src/components/qaza/CreateGoalDialog.tsx` - Создание/редактирование целей
- `src/components/qaza/GoalCard.tsx` - Карточка цели
- `src/components/qaza/CompactGoalsCalendar.tsx` - Компактный календарь на главном экране

**Модульность**: ✅ Все компоненты в отдельной папке `qaza/`, легко масштабируются

**Связь с каза намазами**: ✅ **РЕАЛИЗОВАНО**
- В `SmartGoalsSection` есть блок "Пропущенные намазы" с кнопкой "Посчитать / Восполнить намазы"
- Цели категории "prayer" могут быть связаны с восполнением намазов
- В `CompactGoalsCalendar` есть кнопка "Выполнил +1" для намазов

---

### 3. Тасбих
- **Требование**: 
  - Отдельный модуль для масштабирования
  - Тесно взаимосвязан с зикрами, целями и привычками
  - Возможно добавить аяты для повторения
- **Статус**: ⚠️ **ЧАСТИЧНО РЕАЛИЗОВАНО**

**Реализованные компоненты:**
- `src/components/dhikr/SmartTasbih.tsx` - Умный тасбих

**Что реализовано:**
- ✅ Интеграция с целями - можно выбирать цели и считать для них
- ✅ Интеграция с зикрами - можно выбирать из категорий (дуа, азкары, салаваты, калимы)
- ✅ Загрузка данных из API (дуа, азкары, салаваты, калимы, 99 имен Аллаха)
- ✅ Автоматическое обновление прогресса целей при использовании тасбиха
- ✅ Настройки отображения (арабский текст, транскрипция, перевод)
- ✅ Аудио воспроизведение (для дуа)

**Что нужно добавить:**
- ⚠️ **Аяты для повторения** - пока не реализовано
  - В `getSelectableItems` есть поддержка сур, но не конкретных аятов
  - Нужно добавить возможность выбирать конкретные аяты из Корана

**Модульность**: ✅ Компонент в отдельной папке `dhikr/`, легко масштабируется

**Связь с зикрами**: ✅ **РЕАЛИЗОВАНО**
- Тасбих загружает данные из `useDhikrData()` (дуа, азкары, салаваты, калимы)
- Можно выбирать элементы из категорий зикров
- Данные синхронизируются с API

**Связь с целями**: ✅ **РЕАЛИЗОВАНО**
- Можно выбирать цели из списка активных целей
- При достижении цели в тасбихе автоматически обновляется прогресс цели
- Цели могут быть связаны с конкретными зикрами через `linked_item_id`

---

### 4. Зикры (дуа, Азкары, Салаваты и калимы)
- **Требование**: Отдельный модуль для масштабирования
- **Статус**: ✅ **РЕАЛИЗОВАНО**

**Реализованные компоненты:**
- `src/components/dhikr/DuaSection.tsx` - Раздел дуа
- `src/components/dhikr/DuaCard.tsx` - Карточка дуа
- `src/components/dhikr/AdhkarSection.tsx` - Раздел азкаров
- `src/components/dhikr/AdhkarCard.tsx` - Карточка азкара
- `src/components/dhikr/SalawatSection.tsx` - Раздел салаватов
- `src/components/dhikr/KalimaSection.tsx` - Раздел калим

**Модульность**: ✅ Все компоненты в отдельной папке `dhikr/`, легко масштабируются

**Интеграция с тасбихом**: ✅ **РЕАЛИЗОВАНО**
- Тасбих использует `useDhikrData()` для загрузки всех зикров
- Можно выбирать зикры из тасбиха для подсчета
- Данные синхронизируются между разделами

---

## Итоговая таблица соответствия

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| 1. Восполнение намазов (модуль) | ✅ | Полностью реализовано, модульная структура |
| 2. Цели и привычки (модуль) | ✅ | Полностью реализовано, модульная структура |
| 3. Тасбих (модуль) | ✅ | Реализовано, модульная структура |
| 4. Зикры (модуль) | ✅ | Полностью реализовано, модульная структура |
| Тасбих ↔ Зикры | ✅ | Интегрировано через `useDhikrData()` |
| Тасбих ↔ Цели | ✅ | Интегрировано через `linked_item_id` |
| Каза намазы ↔ Цели | ✅ | Интегрировано через блок в `SmartGoalsSection` |
| Аяты в тасбихе | ✅ | Реализовано: диалог выбора аята, поддержка всех 114 сур, популярные аяты |

---

## ✅ Все требования выполнены!

### Добавлена поддержка аятов в тасбих

**Что реализовано:**
- ✅ Добавлены функции получения сур и аятов в `src/lib/api.ts`:
  - `getSurahs()` - получение списка всех 114 сур
  - `getAyahs()` - получение аятов из суры
  - `getAyah()` - получение конкретного аята
- ✅ Создан файл `src/data/quran-surahs.ts` со всеми 114 сурами Корана
- ✅ Обновлен `src/lib/goals-selectable-items.ts`:
  - Все 114 сур доступны для выбора
  - Популярные аяты (Аят аль-Курси, Йа Син, Ар-Рахман и др.)
  - Опция "Выбрать конкретный аят..." для произвольного выбора
- ✅ Создан компонент `AyahSelectorDialog.tsx`:
  - Выбор суры из списка всех 114
  - Выбор конкретного аята из суры
  - Предпросмотр аята (арабский текст, транскрипция, перевод)
  - Загрузка данных из API с fallback
- ✅ Обновлен `SmartTasbih.tsx`:
  - Поддержка выбора аятов из категории "Коран"
  - Автоматическая загрузка текста аята при выборе
  - Интеграция с диалогом выбора аята
  - Поддержка повторения аятов в тасбихе

**Файлы изменены:**
- `src/lib/api.ts` - добавлены функции для работы с Кораном
- `src/data/quran-surahs.ts` - новый файл со всеми сурами
- `src/lib/goals-selectable-items.ts` - добавлена поддержка всех сур и аятов
- `src/types/goals.ts` - добавлены поля `surah_number` и `ayah_number` в `SelectableItem`
- `src/components/dhikr/AyahSelectorDialog.tsx` - новый компонент для выбора аята
- `src/components/dhikr/SmartTasbih.tsx` - интеграция с аятами

---

## Структура модулей

### Модуль "Восполнение намазов" (`src/components/qaza/`)
```
qaza/
├── RepaymentPlanSection.tsx      # План восполнения
├── ProgressSection.tsx            # Прогресс
├── CalculatorSection.tsx          # Калькулятор
├── TravelPrayersSection.tsx      # Сафар
├── ReportsSection.tsx             # Отчёты
├── PrayerCalendar.tsx             # Календарь
├── AddPrayerDialog.tsx            # Добавление намазов
└── ...
```

### Модуль "Цели и привычки" (`src/components/qaza/`)
```
qaza/
├── SmartGoalsSection.tsx         # Основной раздел
├── CreateGoalDialog.tsx           # Создание цели
├── GoalCard.tsx                   # Карточка цели
└── CompactGoalsCalendar.tsx       # Компактный календарь
```

### Модуль "Тасбих" (`src/components/dhikr/`)
```
dhikr/
└── SmartTasbih.tsx                # Умный тасбих
```

### Модуль "Зикры" (`src/components/dhikr/`)
```
dhikr/
├── DuaSection.tsx                 # Дуа
├── DuaCard.tsx                    # Карточка дуа
├── AdhkarSection.tsx              # Азкары
├── AdhkarCard.tsx                 # Карточка азкара
├── SalawatSection.tsx             # Салаваты
└── KalimaSection.tsx              # Калимы
```

---

## Выводы

✅ **Все основные требования выполнены:**
- Все модули отдельные и масштабируемые
- Тасбих интегрирован с зикрами и целями
- Каза намазы связаны с целями

⚠️ **Одна опциональная функция не реализована:**
- Аяты в тасбихе (заказчик не уверен в востребованности)

**Рекомендация**: Добавить поддержку аятов в тасбих для полноты функционала, но сделать это опционально.

